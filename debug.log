/usr/local/lib/python3.10/dist-packages/distributed/diagnostics/rmm.py:8: FutureWarning: The cuda.cudart module is deprecated and will be removed in a future release, please switch to use the cuda.bindings.runtime module instead.
  import rmm
/usr/local/lib/python3.10/dist-packages/rmm/__init__.py:15: FutureWarning: The cuda.cuda module is deprecated and will be removed in a future release, please switch to use the cuda.bindings.driver module instead.
  from rmm import mr
2025-12-08 14:49:36,020 - INFO - Loading History Data...
2025-12-08 14:49:46,063 - INFO - Loading Models...
2025-12-08 14:49:46,085 - INFO - モデルをロードしました: /workspace/src/scripts/../../models/lgbm_v4_emb.pkl
2025-12-08 14:49:46,086 - INFO - Model internal type: <class 'lightgbm.basic.Booster'>
2025-12-08 14:49:46,086 - INFO - Retrieved feature names from bst.feature_name()
2025-12-08 14:49:46,086 - INFO - Feature Names Determined: 125 features.
2025-12-08 14:49:46,087 - INFO - First 5 features: ['race_number', 'distance', 'frame_number', 'horse_number', 'age']
2025-12-08 14:49:46,111 - INFO - Found 308 race dates in 2025.
2025-12-08 14:49:46,112 - INFO - --- Processing 2025-01-01 ---
2025-12-08 14:49:46,115 - INFO - テーブル検出: jvd_ra
2025-12-08 14:49:46,117 - INFO - テーブル検出: jvd_se
2025-12-08 14:49:46,118 - INFO - テーブル検出: jvd_um
2025-12-08 14:49:46,118 - INFO - PC-KEIBA短縮名スキーマ (jvd_ra, jvd_ur) を検出しました。
2025-12-08 14:49:46,119 - INFO - テーブル検出: jvd_se
2025-12-08 14:49:46,120 - INFO - JRA-VAN推論用データをロード中...
2025-12-08 14:49:46,299 - INFO - ロード件数: 72 件
2025-12-08 14:49:46,302 - INFO - テーブル検出: jvd_o1
2025-12-08 14:49:46,980 - INFO - 推論用データロード完了: 72 件
2025-12-08 14:49:46,981 - INFO - 推論用前処理を開始します (Incremental Mode)...
2025-12-08 14:49:46,981 - INFO - キャッシュされた過去データを使用します。
2025-12-08 14:49:46,982 - INFO - 基本特徴量の生成を開始...
2025-12-08 14:49:46,985 - INFO - 基本特徴量の生成完了
2025-12-08 14:49:47,070 - INFO - 過去走特徴量の生成を開始...
2025-12-08 14:49:47,073 - INFO - 前走データの生成中...
2025-12-08 14:49:47,076 - INFO - 近5走平均データの生成中...
2025-12-08 14:49:47,100 - INFO - 通算成績データの生成中...
2025-12-08 14:49:47,123 - INFO - 過去走特徴量の生成完了
2025-12-08 14:49:47,123 - INFO - カテゴリ特徴量のインクリメンタル更新中...
2025-12-08 14:49:47,139 - INFO - 血統特徴量の生成を開始...
2025-12-08 14:49:47,140 - INFO - 競走馬マスタから血統情報をロード中...
2025-12-08 14:49:55,161 - INFO - 血統情報ロード完了: 211057頭
2025-12-08 14:49:55,167 - INFO - 血統情報を以下のカラムで結合します: ['bms_id']
2025-12-08 14:49:55,202 - INFO - 種牡馬(Sire)別の集計特徴量を生成中...
2025-12-08 14:49:55,220 - INFO - 母父(BMS)別の集計特徴量を生成中...
2025-12-08 14:49:55,240 - INFO - 血統特徴量の生成完了
2025-12-08 14:49:55,241 - INFO - カテゴリ・コンテキスト特徴量のインクリメンタル更新中...
2025-12-08 14:49:58,097 - INFO - Embedding Mapをロード中: /workspace/src/scripts/../preprocessing/../../models/embeddings/embedding_maps.pkl
2025-12-08 14:49:58,512 - INFO - Embedding特徴量を追加中...
2025-12-08 14:49:58,545 - INFO - 高度特徴量の生成を開始...
/workspace/src/scripts/../preprocessing/advanced_features.py:41: PerformanceWarning: DataFrame is highly fragmented.  This is usually the result of calling `frame.insert` many times, which has poor performance.  Consider joining all columns at once using pd.concat(axis=1) instead. To get a de-fragmented frame, use `newframe = frame.copy()`
  df['is_nige_temp'] = df['passing_rank'].apply(is_nige)
2025-12-08 14:49:58,612 - INFO - v6 新規特徴量を生成中...
2025-12-08 14:49:58,638 - INFO - 高度特徴量の生成完了
2025-12-08 14:49:58,639 - INFO - 不利検出特徴量の生成を開始...
2025-12-08 14:49:58,710 - INFO - 不利検出特徴量の生成完了
2025-12-08 14:49:58,711 - INFO - 相対的特徴量の生成を開始...
2025-12-08 14:49:59,266 - INFO - 相対的特徴量の生成完了
2025-12-08 14:49:59,270 - INFO - リアルタイム特徴量(当日の傾向)を生成中...
2025-12-08 14:49:59,467 - INFO - リアルタイム特徴量生成完了: 5 features processed.
2025-12-08 14:49:59,469 - INFO - 特徴量生成完了。推論対象: 72 件
[LightGBM] [Fatal] The number of features in data (128) is not the same as it was in training data (125).
You can set ``predict_disable_shape_check=true`` to discard this error, but please be aware what you are doing.
Traceback (most recent call last):
  File "/workspace/src/scripts/run_ytd_simulation.py", line 263, in <module>
    run_simulation()
  File "/workspace/src/scripts/run_ytd_simulation.py", line 166, in run_simulation
    scores = model.predict(X_pred)
  File "/workspace/src/scripts/../model/lgbm.py", line 90, in predict
    return self.model.predict(X, num_iteration=self.model.best_iteration)
  File "/usr/local/lib/python3.10/dist-packages/lightgbm/basic.py", line 4767, in predict
    return predictor.predict(
  File "/usr/local/lib/python3.10/dist-packages/lightgbm/basic.py", line 1204, in predict
    preds, nrow = self.__pred_for_np2d(
  File "/usr/local/lib/python3.10/dist-packages/lightgbm/basic.py", line 1361, in __pred_for_np2d
    return self.__inner_predict_np2d(
  File "/usr/local/lib/python3.10/dist-packages/lightgbm/basic.py", line 1307, in __inner_predict_np2d
    _safe_call(
  File "/usr/local/lib/python3.10/dist-packages/lightgbm/basic.py", line 313, in _safe_call
    raise LightGBMError(_LIB.LGBM_GetLastError().decode("utf-8"))
lightgbm.basic.LightGBMError: The number of features in data (128) is not the same as it was in training data (125).
You can set ``predict_disable_shape_check=true`` to discard this error, but please be aware what you are doing.
