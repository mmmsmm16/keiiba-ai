---
description: 2025年最新モデル(Q8 Ensemble)を用いた日次予測と馬券選定の実行手順
---

# 競馬AI 2025年 運用ワークフロー

このワークフローは、最新のJRAレースデータに対して「特徴量生成」「アンサンブル予測」「Adaptive Filterによる馬券選定」を一括で実行する手順を定義します。

## 1. 事前準備
- JRA-VANデータが最新の状態であることを確認してください（外部ローダーによるデータ同期）。
- DBに最新の開催データ・出馬表が登録されている必要があります。

## 2. 予測の実行 (Daily Run)
当日の予測を実行するには、以下のコマンドを実行します。

// turbo
```bash
docker compose exec app python scripts/production_run.py
```

### 特定の日付を指定する場合
過去のデータ検証や、前日に翌日の予測を行う場合などに使用します。

```bash
docker compose exec app python scripts/production_run.py --date 20251224
```

## 3. 推奨馬の確認
実行後、標準出力に以下の形式で推奨馬（Betting Sheet）が表示されます。

```text
==================================================
 🏇 KEIIBA-AI PRODUCTION RECOMMENDATIONS (2025) 
 Strategy: Trio Nagashi 1-Head 7-Followers [Ad-Strict]
==================================================

[2025年01月05日 中山 11R] (ID: 202506010511)
No  馬名             騎手         予測値     オッズ
-------------------------------------------------------
07  ブレイディヴェーグ    ルメール         15.20%   2.8
02  ...              ...          8.50%    12.3
...
💡 推奨買い目:
  - 軸馬: 07 (ブレイディヴェーグ)
  - 相手: 02, 05, 08, 10, 12, 14, 15

  ★高回収率アラート★
  条件合致: 確率 30.00% >= 30% かつ オッズ 2.0-20.0倍
  勝負レース推奨: 単勝 / ワイド流し / 三連複1頭軸
```

## 4. 自動実行とDiscord通知の構成
毎朝 9:00 に自動的に予測を実行し、結果を Discord に通知するスケジューラを利用できます。

### Discord通知の設定
`.env` ファイル（または環境変数）に Webhook URL を設定してください。

```bash
DISCORD_WEBHOOK_URL="https://discord.com/api/webhooks/YOUR_WEBHOOK_ID/YOUR_TOKEN"
```

### スケジューラの起動
以下のコマンドでスケジューラを起動し、バックグラウンドで常駐させます。

```bash
# ログを確認しながら実行する場合
docker compose exec app python scripts/daily_scheduler.py

# バックグラウンドで実行し続ける場合 (推奨)
docker compose exec -d app python scripts/daily_scheduler.py
```

※ 開発環境（Docker）が起動している間のみ有効です。PCを再起動した場合は再度実行してください。

## 5. 注意事項
- **PCの電源とスリープ**:
    - 本システムはローカルPC上のDockerコンテナで動作しています。**PCがスリープ状態やシャットダウン状態ではスケジュールは実行されません。**
    - 毎朝9:00に自動実行させるためには、PCが起動しており、かつスリープしていない必要があります（Windowsの電源設定でスリープを無効にするか、実行時間帯に起きている必要があります）。
- **Adaptive Filter**: 全レースの予測スコアは表形式で表示されますが、**「推奨買い目」**は予測確率が 10% 未満のレースでは表示されません。これは ROI を守るためのガードレールです。
- **データ依存**: 特徴量生成には過去の履歴データが必要なため、DBのインデックスや過去データが欠落していると精度が低下します。
- **モデル**: `models/experiments/exp_r3_ensemble/` 配下の最新モデルを使用します。
