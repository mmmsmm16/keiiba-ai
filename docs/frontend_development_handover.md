# フロントエンド開発への引継ぎ資料 (Webベットシミュレーター)

## 📅 現況ステータス
バックエンド（FastAPI + 計算ロジック）の実装とテストが完了しており、稼働中です。
次は **Next.js でのフロントエンド画面 (UI)** を実装するフェーズになります。

---

## 🔗 バックエンド API 仕様

### エンドポイント
*   **URL**: `http://localhost:8000/api/simulation/run`
*   **Method**: `POST`
*   **Content-Type**: `application/json`

### リクエスト仕様 (Request Body)
シミュレーション条件と、複数の戦略リストを送信します。

```json
{
  "model_path": "reports/predictions_v5_2025.csv",  // 使用するモデル予測データ (v5 または v4)
  "filters": {
    "surface": "芝",          // "芝" or "ダート" (省略可)
    "place": ["東京", "京都"]  // 競馬場リスト (省略可)
  },
  "strategies": [
    // 戦略1: 3連単 ギャップ戦略 (フォーメーション)
    {
      "type": "SanRenTan",
      "name": "ギャップ戦略",
      "formation": [
        [1],           // 1着: 予測1位
        [3,4,5,6],     // 2着: 予測3-6位
        [2,3,4,5,6]    // 3着: 予測2-6位
      ]
    },
    // 戦略2: ワイド Box
    {
      "type": "Wide",
      "name": "ワイドBox",
      "formation": [
        [1,2,3]        // ボックスの場合は1つのリストで指定
      ]
    }
  ]
}
```

*   **Formation の指定ルール**:
    *   `[ [1着候補], [2着候補], [3着候補] ]` のようにランク(予測順位)のリストを配列で渡します。
    *   **馬連/ワイド/3連複**:
        *   ボックス買いの場合: `[ [1,2,3,4,5] ]` (リスト1つ)
        *   軸流しの場合: `[ [1], [2,3,4,5] ]` (軸, 相手)
    *   **3連単**: 必ず3つのリスト `[ [1着], [2着], [3着] ]` が必要です。

### レスポンス仕様 (Response)

```json
{
  "summary": {
    "roi": 105.7,            // 全体の回収率 (%)
    "total_profit": 52000,   // 純利益 (円)
    "total_bet": 1000000,    // 総購入額 (円)
    "race_count": 1601       // 対象レース数
  },
  "strategies": {
    "ギャップ戦略": {
      "total_bet": 800000,
      "total_return": 900000,
      "hit_rate": 8.8,
      "roi": 112.5,
      "race_count": 1601
    },
    "ワイドBox": {
      "roi": 79.8,
      ...
    }
  }
}
```

---

## 🖥️ フロントエンド実装 ToDo (Next.js)

`src/web/app/simulation/page.tsx` (新規作成) に以下の機能を実装してください。

1.  **条件設定パネル**:
    *   **モデル選択**: プルダウンで `v5 (JRA-Only)`, `v4 (Full)` を選択。
        *   値はそれぞれ `reports/predictions_v5_2025.csv`, `reports/predictions_v4_2025.csv` を送信。
    *   **フィルタ**: 芝/ダートのトグルスイッチ。

2.  **戦略ビルダー (Strategy Builder)**:
    *   ユーザーが戦略を「追加」できるリストUI。
    *   各戦略で **券種** (3連単など) を選択。
    *   **フォーメーション入力UI**:
        *   「1着」「2着」「3着」の各行に対して、予測順位ボタン (1〜6位 etc) を作って複数選択できるようにすると直感的です。
        *   例: [1] [2] [3] [4] [5] [6] のボタンを並べて、クリックでトグル。

3.  **実行＆結果表示**:
    *   「シミュレーション実行」ボタンで API を叩く。
    *   結果の ROI と 利益 を大きく表示。
    *   各戦略ごとの成績をテーブル表示。

## 📂 関連ファイル
*   バックエンドロジック: `src/simulation/simulator.py`
*   APIルーター: `src/api/routers/simulation.py`

---
*この資料を次のセッションの担当AIに共有して、「WebシミュレーターのUIを作ってください」と依頼すればスムーズに進みます。*
